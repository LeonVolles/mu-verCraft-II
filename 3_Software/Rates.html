<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>µCraft Rate Curve Explorer</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 900px;
            width: 100%;
        }
        h1 { margin-top: 0; text-align: center; color: #2c3e50; }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .control-group {
            display: flex;
            flex-direction: column;
        }
        label {
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }
        input[type=range] {
            width: 100%;
            cursor: pointer;
        }
        .value-display { color: #007bff; }
        canvas {
            width: 100%;
            height: 500px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #fff;
        }
        .footer {
            margin-top: 20px;
            text-align: center;
            font-size: 0.9em;
            color: #666;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>µCraft Rate Curve Explorer</h1>
    
    <div class="controls">
        <div class="control-group">
            <label>
                Max Yaw Rate (deg/s)
                <span id="val-max" class="value-display">1080</span>
            </label>
            <input type="range" id="slider-max" min="100" max="2000" step="10" value="1080">
        </div>

        <div class="control-group">
            <label>
                Center Sensitivity (deg/s)
                <span id="val-sens" class="value-display">250</span>
            </label>
            <input type="range" id="slider-sens" min="10" max="1000" step="10" value="400">
        </div>

        <div class="control-group">
            <label>
                Expo
                <span id="val-expo" class="value-display">0.70</span>
            </label>
            <input type="range" id="slider-expo" min="0" max="1.0" step="0.01" value="0.06">
        </div>
    </div>

    <canvas id="chartCanvas"></canvas>
    
    <div class="footer">
        Move sliders to update the curve in real-time.
    </div>
</div>

<script>
    const canvas = document.getElementById('chartCanvas');
    const ctx = canvas.getContext('2d');
    
    // Sliders
    const sliderMax = document.getElementById('slider-max');
    const sliderSens = document.getElementById('slider-sens');
    const sliderExpo = document.getElementById('slider-expo');
    
    // Displays
    const valMax = document.getElementById('val-max');
    const valSens = document.getElementById('val-sens');
    const valExpo = document.getElementById('val-expo');

    function resizeCanvas() {
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);
        draw();
    }

    function calculateRate(steeringPercent, maxRate, centerSens, expo) {
        // Input: -100 to 100
        const stick = Math.max(-100, Math.min(100, steeringPercent)) * 0.01; // -1 to 1
        const a = Math.abs(stick);
        
        let maxRateVal = Math.max(0, maxRate);
        let centerVal = Math.max(0, centerSens);
        
        // Betaflight logic: center sens cannot exceed max rate
        if (centerVal > maxRateVal) centerVal = maxRateVal;
        
        const expoVal = Math.max(0, Math.min(1, expo));
        const p = 3.0 + 2.0 * expoVal;
        
        const rateAbs = centerVal * a + (maxRateVal - centerVal) * Math.pow(a, p);
        
        return (stick < 0) ? -rateAbs : rateAbs;
    }

    function draw() {
        const width = canvas.offsetWidth;
        const height = canvas.offsetHeight;
        
        // Clear
        ctx.clearRect(0, 0, width, height);
        
        // Params
        const maxRate = parseFloat(sliderMax.value);
        const centerSens = parseFloat(sliderSens.value);
        const expo = parseFloat(sliderExpo.value);
        
        // Update labels
        valMax.textContent = maxRate;
        valSens.textContent = centerSens;
        valExpo.textContent = expo.toFixed(2);
        
        // Setup Grid
        const padding = 60;
        const plotW = width - padding * 2;
        const plotH = height - padding * 2;
        
        const xMin = -100;
        const xMax = 100;
        const yLimit = Math.max(1000, maxRate * 1.1); 
        const yMin = -yLimit;
        const yMax = yLimit;
        
        // Helper to map coordinates
        const mapX = (val) => padding + ((val - xMin) / (xMax - xMin)) * plotW;
        const mapY = (val) => padding + plotH - ((val - yMin) / (yMax - yMin)) * plotH;
        
        // Draw Grid Lines
        ctx.strokeStyle = '#eee';
        ctx.lineWidth = 1;
        ctx.beginPath();
        
        // Vertical grid
        for(let x = -100; x <= 100; x += 25) {
            const px = mapX(x);
            ctx.moveTo(px, padding);
            ctx.lineTo(px, height - padding);
            
            // Text
            ctx.fillStyle = '#999';
            ctx.textAlign = 'center';
            ctx.fillText(x + '%', px, height - padding + 20);
        }
        
        // Horizontal grid
        const yStep = Math.round(yLimit / 500) * 100 || 200; 
        for(let y = 0; y <= yLimit; y += yStep) {
            // Positive
            let py = mapY(y);
            ctx.moveTo(padding, py);
            ctx.lineTo(width - padding, py);
            // Negative
            if(y !== 0) {
                let ny = mapY(-y);
                ctx.moveTo(padding, ny);
                ctx.lineTo(width - padding, ny);
            }
        }
        ctx.stroke();
        
        // Axes
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 1.5;
        ctx.beginPath();
        // X Axis
        ctx.moveTo(padding, mapY(0));
        ctx.lineTo(width - padding, mapY(0));
        // Y Axis
        ctx.moveTo(mapX(0), padding);
        ctx.lineTo(mapX(0), height - padding);
        ctx.stroke();
        
        // Y Labels
        ctx.textAlign = 'right';
        ctx.textBaseline = 'middle';
        ctx.fillStyle = '#666';
        for(let y = 0; y <= yLimit; y += yStep) {
            ctx.fillText(y, padding - 10, mapY(y));
            if(y !== 0) ctx.fillText(-y, padding - 10, mapY(-y));
        }

        // Draw Curve
        ctx.strokeStyle = '#007bff';
        ctx.lineWidth = 3;
        ctx.beginPath();
        
        let first = true;
        for (let i = -100; i <= 100; i += 1) {
            const rate = calculateRate(i, maxRate, centerSens, expo);
            const px = mapX(i);
            const py = mapY(rate);
            
            if (first) {
                ctx.moveTo(px, py);
                first = false;
            } else {
                ctx.lineTo(px, py);
            }
        }
        ctx.stroke();
        
        // Draw dots
        ctx.fillStyle = '#dc3545';
        [0, 50, 100, -50, -100].forEach(p => {
            const r = calculateRate(p, maxRate, centerSens, expo);
            const px = mapX(p);
            const py = mapY(r);
            ctx.beginPath();
            ctx.arc(px, py, 5, 0, Math.PI * 2);
            ctx.fill();
        });
    }

    // Listeners
    sliderMax.addEventListener('input', draw);
    sliderSens.addEventListener('input', draw);
    sliderExpo.addEventListener('input', draw);
    window.addEventListener('resize', resizeCanvas);

    // Init
    resizeCanvas();
</script>

</body>
</html>
